<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>3D Майнер Игровой Валюты</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; color: #fff; font-family: Arial, sans-serif; }
    #score { position: absolute; top: 20px; left: 20px; font-size: 24px; background: rgba(0,0,0,0.5); padding: 10px 15px; border-radius: 8px; }
    canvas { display: block; }
    #info { position: absolute; bottom: 20px; left: 20px; font-size: 16px; color: #aaa; }
  </style>
</head>
<body>
  <div id="score">Очки: 0</div>
  <div id="info">Кликни на майнера чтобы добыть валюту</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.min.js"></script>

  <script>
    // Сцена, камера, рендер
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 2, 5);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Свет
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(5, 10, 7);
    scene.add(directionalLight);

    // Контролы (вращение сцены мышью)
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Майнер (робот) — базовая модель из геометрии + материалы
    const minerGroup = new THREE.Group();

    // Тело - куб с металлом
    const bodyGeom = new THREE.BoxGeometry(1, 1.5, 0.6);
    const bodyMat = new THREE.MeshStandardMaterial({color: 0x8888ff, metalness: 0.7, roughness: 0.2});
    const body = new THREE.Mesh(bodyGeom, bodyMat);
    minerGroup.add(body);

    // Голова - сфера
    const headGeom = new THREE.SphereGeometry(0.4, 32, 32);
    const headMat = new THREE.MeshStandardMaterial({color: 0x5555ff, metalness: 0.8, roughness: 0.3});
    const head = new THREE.Mesh(headGeom, headMat);
    head.position.set(0, 1.2, 0);
    minerGroup.add(head);

    // Глаза - светящиеся сферы
    const eyeGeom = new THREE.SphereGeometry(0.07, 16, 16);
    const eyeMat = new THREE.MeshBasicMaterial({color: 0x00ffcc});
    const leftEye = new THREE.Mesh(eyeGeom, eyeMat);
    const rightEye = new THREE.Mesh(eyeGeom, eyeMat);
    leftEye.position.set(-0.15, 1.3, 0.35);
    rightEye.position.set(0.15, 1.3, 0.35);
    minerGroup.add(leftEye);
    minerGroup.add(rightEye);

    // Руки - цилиндры
    const armGeom = new THREE.CylinderGeometry(0.1, 0.1, 1, 16);
    const armMat = new THREE.MeshStandardMaterial({color: 0x7777ff, metalness: 0.7, roughness: 0.3});
    const leftArm = new THREE.Mesh(armGeom, armMat);
    const rightArm = new THREE.Mesh(armGeom, armMat);
    leftArm.position.set(-0.7, 0.25, 0);
    leftArm.rotation.z = Math.PI / 6;
    rightArm.position.set(0.7, 0.25, 0);
    rightArm.rotation.z = -Math.PI / 6;
    minerGroup.add(leftArm);
    minerGroup.add(rightArm);

    // Ноги - кубы
    const legGeom = new THREE.BoxGeometry(0.3, 0.8, 0.3);
    const legMat = new THREE.MeshStandardMaterial({color: 0x6666ff, metalness: 0.7, roughness: 0.4});
    const leftLeg = new THREE.Mesh(legGeom, legMat);
    const rightLeg = new THREE.Mesh(legGeom, legMat);
    leftLeg.position.set(-0.3, -1, 0);
    rightLeg.position.set(0.3, -1, 0);
    minerGroup.add(leftLeg);
    minerGroup.add(rightLeg);

    scene.add(minerGroup);

    // Заземление майнера - плоскость
    const groundGeom = new THREE.PlaneGeometry(10, 10);
    const groundMat = new THREE.MeshStandardMaterial({color: 0x222222, roughness: 1});
    const ground = new THREE.Mesh(groundGeom, groundMat);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -1.8;
    scene.add(ground);

    // Баланс очков
    let score = 0;
    const scoreEl = document.getElementById('score');

    // Raycaster для кликов
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    function onClick(event) {
      // Нормализуем координаты мыши для Three.js (-1 до 1)
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);

      // Проверяем пересечение с майнером
      const intersects = raycaster.intersectObject(minerGroup, true);

      if (intersects.length > 0) {
        // Добавляем очки
        score += 1;
        scoreEl.textContent = `Очки: ${score}`;

        // Визуальный отклик — легкое "пульсирование" тела
        const scaleUp = 1.2;
        const duration = 100; // ms
        const originalScale = minerGroup.scale.x;

        // Анимация "щелчка"
        const start = performance.now();
        function animatePulse(time) {
          const elapsed = time - start;
          if (elapsed < duration) {
            const scale = originalScale + (scaleUp - originalScale) * (elapsed / duration);
            minerGroup.scale.set(scale, scale, scale);
            requestAnimationFrame(animatePulse);
          } else {
            // Вернуть обратно
            minerGroup.scale.set(originalScale, originalScale, originalScale);
          }
        }
        requestAnimationFrame(animatePulse);
      }
    }

    window.addEventListener('click', onClick);

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Анимация
    function animate() {
      requestAnimationFrame(animate);
      minerGroup.rotation.y += 0.005; // Медленное вращение
      controls.update();
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>