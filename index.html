<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∏–±–µ—Ä–ø–∞–Ω–∫ ASIC 3D –ö–ª–∏–∫–µ—Ä</title>
  <style>
    body {
      margin: 0; overflow: hidden;
      background: radial-gradient(circle at center, #0a0a0a 0%, #120018 80%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #0ff;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
    }
    #overlay {
      position: absolute;
      top: 10px; left: 10px; right: 10px;
      display: flex;
      justify-content: space-between;
      color: #0ff;
      font-weight: 700;
      font-size: 24px;
      z-index: 10;
      text-shadow: 0 0 10px #0ff;
    }
    #shop-toggle {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: linear-gradient(135deg, #00fff7, #0099ff);
      border: none;
      padding: 14px 26px;
      border-radius: 30px;
      color: #001122;
      font-weight: 700;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 0 15px #00fff7;
      transition: all 0.3s ease;
      z-index: 10;
      user-select: none;
    }
    #shop-toggle:hover {
      box-shadow: 0 0 25px #00ffff;
      transform: scale(1.05);
    }
    #shop {
      position: fixed;
      bottom: -420px;
      left: 0; right: 0;
      margin: 0 auto;
      max-width: 700px;
      background: rgba(0, 255, 255, 0.1);
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      padding: 20px;
      box-shadow: 0 -5px 30px #00ffff88;
      color: #0ff;
      font-weight: 600;
      font-size: 18px;
      backdrop-filter: blur(10px);
      transition: bottom 0.5s ease;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      z-index: 9;
      user-select: none;
    }
    #shop.open {
      bottom: 0;
    }
    .shop-item {
      background: rgba(0,255,255,0.2);
      border-radius: 12px;
      padding: 14px 20px;
      width: 180px;
      box-shadow: 0 0 10px #00ffffaa;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.3s ease;
      cursor: pointer;
    }
    .shop-item:hover {
      box-shadow: 0 0 25px #00ffff;
    }
    .shop-item h3 {
      margin: 0 0 10px;
      text-align: center;
      font-size: 20px;
      text-shadow: 0 0 10px #00ffff;
    }
    .shop-item button {
      background: linear-gradient(135deg, #00ffff, #0099ff);
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      color: #001122;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 15px #00ffff;
      transition: background 0.3s ease;
      width: 100%;
    }
    .shop-item button:disabled {
      background: #003344;
      box-shadow: none;
      color: #555;
      cursor: default;
    }
  </style>
</head>
<body>

<div id="overlay">
  <div id="score">–û—á–∫–∏: 0</div>
  <div id="income">–î–æ—Ö–æ–¥/—Å–µ–∫: 0</div>
</div>
<button id="shop-toggle">–ú–∞–≥–∞–∑–∏–Ω üõí</button>
<div id="shop"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
<script>
  // --- Setup scene, camera, renderer ---
  const scene = new THREE.Scene();

  // –ö–∏–±–µ—Ä–ø–∞–Ω–∫ –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ - —Å–∏–Ω–∏–π —Å –Ω–µ–æ–Ω–æ–≤—ã–º —Å–≤–µ—á–µ–Ω–∏–µ–º
  const ambientLight = new THREE.AmbientLight(0x0ff8ff, 0.3);
  scene.add(ambientLight);

  const pointLight = new THREE.PointLight(0x00ffff, 1.5, 100);
  pointLight.position.set(0, 5, 10);
  scene.add(pointLight);

  const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(0, 3, 7);

  const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Orbit controls –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –º—ã—à—å—é –≤–æ–∫—Ä—É–≥ ASIC
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.minDistance = 4;
  controls.maxDistance = 10;
  controls.target.set(0, 1, 0);
  controls.update();

  // --- –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–ø—É—Å ASIC ---
  const asic = new THREE.Group();

  // –ö–æ—Ä–ø—É—Å
  const bodyGeo = new THREE.BoxGeometry(4, 1.5, 2);
  const bodyMat = new THREE.MeshStandardMaterial({
    color: 0x002a3a,
    metalness: 0.8,
    roughness: 0.2,
    emissive: 0x005577,
    emissiveIntensity: 0.3
  });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = 1;
  asic.add(body);

  // –ü–µ—Ä–µ–¥–Ω—è—è –ø–∞–Ω–µ–ª—å —Å "—Å–≤–µ—Ç—è—â–∏–º–∏—Å—è" –ª–∏–Ω–∏—è–º–∏
  const frontGeo = new THREE.PlaneGeometry(4, 1.5);
  const frontMat = new THREE.MeshBasicMaterial({
    color: 0x00ffff,
    opacity: 0.2,
    transparent: true,
    side: THREE.DoubleSide
  });
  const frontPanel = new THREE.Mesh(frontGeo, frontMat);
  frontPanel.position.set(0, 1, 1.01);
  asic.add(frontPanel);

  // –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã (3 —à—Ç—É–∫–∏)
  const fanGroup = new THREE.Group();
  const fanRadius = 0.6;
  const fanThickness = 0.2;

  const fanPositions = [-1.3, 0, 1.3];
  fanPositions.forEach(xPos => {
    const fanBaseGeo = new THREE.CylinderGeometry(fanRadius, fanRadius, fanThickness, 32);
    const fanBaseMat = new THREE.MeshStandardMaterial({
      color: 0x004466,
      metalness: 0.9,
      roughness: 0.1,
      emissive: 0x0088aa,
      emissiveIntensity: 0.4
    });
    const fanBase = new THREE.Mesh(fanBaseGeo, fanBaseMat);
    fanBase.rotation.x = Math.PI / 2;
    fanBase.position.set(xPos, 1, -1);
    fanGroup.add(fanBase);

    // –õ–æ–ø–∞—Å—Ç–∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞
    const blades = new THREE.Group();
    const bladeGeo = new THREE.BoxGeometry(0.1, 0.02, 0.6);
    const bladeMat = new THREE.MeshStandardMaterial({
      color: 0x00ffff,
      metalness: 0.6,
      roughness: 0.1,
      emissive: 0x00aaff,
      emissiveIntensity: 0.8
    });

    for(let i=0; i<6; i++) {
      const blade = new THREE.Mesh(bladeGeo, bladeMat);
      blade.position.z = 0.3;
      blade.rotation.y = i * Math.PI/3;
      blades.add(blade);
    }
    blades.position.set(xPos, 1, -1);
    fanGroup.add(blades);

    // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤
    fanBase.userData.spin = 0.02;
    blades.userData.spin = 0.1;
  });
  asic.add(fanGroup);

  scene.add(asic);

  // --- 3D –∞–Ω–∏–º–∞—Ü–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä ---
  function animate() {
    requestAnimationFrame(animate);

    fanGroup.children.forEach(obj => {
      if(obj.userData.spin) obj.rotation.z += obj.userData.spin;
    });

    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // --- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ---
  const scoreEl = document.getElementById('score');
  const incomeEl = document.getElementById('income');
  const shopToggleBtn = document.getElementById('shop-toggle');
  const shopEl = document.getElementById('shop');

  const shopItems = [
    { id: 'X1', name: 'ASIC X1', cost: 50, income: 1 },
    { id: 'S9', name: 'Antminer S9', cost: 200, income: 5 },
    { id: 'S19', name: 'Antminer S19', cost: 1000, income: 30 },
    { id: 'M30', name: 'WhatsMiner M30', cost: 5000, income: 150 }
  ];

  let state = {
    score: 0,
    owned: { X1: 1, S9: 0, S19: 0, M30: 0 }
  };

  const saveKey = 'asicCyberClickerState';

  function save() {
    localStorage.setItem(saveKey, JSON.stringify(state));
  }
  function load() {
    const data = localStorage.getItem(saveKey);
    if(data) state = JSON.parse(data);
  }

  function calcIncome() {
    return shopItems.reduce((sum, item) => sum + (state.owned[item.id] || 0)*item.income, 0);
  }

  function updateUI() {
    scoreEl.textContent = `–û—á–∫–∏: ${Math.floor(state.score)}`;
    incomeEl.textContent = `–î–æ—Ö–æ–¥/—Å–µ–∫: ${calcIncome()}`;

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ—Ä–ø—É—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ª—É—á—à–µ–≥–æ ASIC
    const bestItem = shopItems.slice().reverse().find(item => (state.owned[item.id]||0)>0);
    if(bestItem) {
      let colorMap = {
        X1: 0x002a3a,
        S9: 0x004466,
        S19: 0x006688,
        M30: 0x0088aa
      };
      body.material.color.setHex(colorMap[bestItem.id] || 0x002a3a);
      body.material.emissive.setHex(colorMap[bestItem.id] || 0x005577);
      body.material.emissiveIntensity = 0.4;
    }
  }

  function createShopUI() {
    shopEl.innerHTML = '';
    shopItems.forEach(item => {
      const div = document.createElement('div');
      div.className = 'shop-item';

      const title = document.createElement('h3');
      title.textContent = item.name;
      div.appendChild(title);

      const btn = document.createElement('button');
      btn.textContent = `–ö—É–ø–∏—Ç—å –∑–∞ ${item.cost} –æ—á–∫–æ–≤`;
      btn.disabled = state.score < item.cost;
      btn.onclick = () => {
        if(state.score >= item.cost) {
          state.score -= item.cost;
          state.owned[item.id] = (state.owned[item.id] || 0) + 1;
          save();
          updateUI();
          createShopUI();
        }
      };
      div.appendChild(btn);

      const countLabel = document.createElement('div');
      countLabel.textContent = `–í –Ω–∞–ª–∏—á–∏–∏: ${state.owned[item.id] || 0}`;
      countLabel.style.marginTop = '8px';
      div.appendChild(countLabel);

      shopEl.appendChild(div);
    });
  }

  shopToggleBtn.onclick = () => {
    shopEl.classList.toggle('open');
  };

  // –ö–ª–∏–∫ –Ω–∞ ASIC - –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—á–∫–∏ –≤—Ä—É—á–Ω—É—é
  let raycaster = new THREE.Raycaster();
  let mouse = new THREE.Vector2();
  let clicked = false;

  function onClick(event) {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);

    const intersects = raycaster.intersectObject(body);
    if(intersects.length > 0) {
      state.score++;
      save();
      updateUI();
      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ
      body.material.emissiveIntensity = 1;
      setTimeout(() => {
        body.material.emissiveIntensity = 0.4;
      }, 150);
    }
  }
  window.addEventListener('click', onClick);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  setInterval(() => {
    state.score += calcIncome();
    save();
    updateUI();
    createShopUI();
  }, 1000);

  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  load();
  updateUI();
  createShopUI();

  // –ü—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

</body>
</html>