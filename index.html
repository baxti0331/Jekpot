<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Генератор QR/Barcode</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter&display=swap');
  *, *::before, *::after { box-sizing: border-box; }

  body {
    margin: 0; padding: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
  }

  .container {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    padding: 30px 40px;
    max-width: 460px; width: 100%;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    text-align: center;
  }

  h1 { margin-bottom: 20px; font-size: 28px; font-weight: 700; }

  label { display:block; text-align:left; margin-bottom:6px; font-weight:600; }

  input, select, button {
    width: 100%;
    padding: 12px;
    margin-bottom: 16px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
  }

  button {
    background:#2575fc;
    color:#fff;
    font-weight:700;
    cursor:pointer;
    transition: 0.3s;
  }

  button:disabled { background: #7a96e0; cursor: not-allowed; }
  button:hover:not(:disabled) { background:#1b56d9; }

  #qrCode, #barcodeContainer {
    margin-top:20px;
    display:flex;
    justify-content:center;
  }

  canvas, svg {
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,0.25);
  }

  .button-group {
    display:flex;
    gap:12px;
    flex-direction:column;
    margin-top:16px;
  }

  /* Слайд-панель */
  .slide-panel {
    position: fixed;
    top:0; right:-100%;
    width:100%; height:100%;
    background:rgba(0,0,0,0.8);
    display:flex; justify-content:center; align-items:center;
    transition: right 0.4s ease;
    z-index:1000;
  }
  .slide-panel.open { right:0; }

  .panel-content {
    background:#fff; color:#222;
    padding:30px; border-radius:12px;
    width:90%; max-width:400px;
    text-align:center;
  }
  .panel-content button { margin-top:12px; }

  footer { margin-top:20px; font-size:13px; color:rgba(255,255,255,0.6); }

</style>
</head>
<body>

<div class="container">
  <h1>Генератор QR + EAN‑13</h1>

  <!-- QR-блок -->
  <label>Текст или URL для QR:</label>
  <input type="text" id="textInput" placeholder="https://example.com">
  <label>Цвет QR:</label><input type="color" id="fgColor" value="#000000">
  <label>Фон QR:</label><input type="color" id="bgColor" value="#ffffff">
  <label>Размер QR:</label>
  <select id="sizeSelect">
    <option value="128">128×128</option>
    <option value="256" selected>256×256</option>
    <option value="384">384×384</option>
    <option value="512">512×512</option>
  </select>
  <label>Логотип (опц.):</label><input type="file" id="logoFile" accept="image/*">
  <button id="generateBtn" disabled>Сгенерировать QR-код</button>
  <div id="qrCode"></div>
  <div class="button-group">
    <button id="downloadBtn" style="display:none;">Скачать PNG</button>
    <button id="printBtn" style="display:none;">Распечатать QR-код</button>
    <button id="openBarcodeBtn">Генератор штрихкодов</button>
  </div>
  <footer>© 2025 Генератор QR/Barcode</footer>
</div>

<!-- Слайд-панель -->
<div class="slide-panel" id="barcodeSlide">
  <div class="panel-content">
    <h2>Генератор EAN‑13</h2>
    <label>Введите 12 цифр:</label>
    <input type="text" id="eanInput" placeholder="123456789012" maxlength="12">
    <button id="genBarcodeBtn" disabled>Сгенерировать штрихкод</button>
    <div id="barcodeContainer"></div>
    <div class="button-group">
      <button id="barcodeDownloadBtn" style="display:none;">Скачать PNG</button>
      <button id="barcodePrintBtn" style="display:none;">Распечатать</button>
      <button id="closeBarcodeBtn">Закрыть</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script>
(() => {
  // --- QR-код ---
  const textInput = document.getElementById('textInput');
  const fgColor = document.getElementById('fgColor');
  const bgColor = document.getElementById('bgColor');
  const sizeSelect = document.getElementById('sizeSelect');
  const logoFile = document.getElementById('logoFile');
  const genBtn = document.getElementById('generateBtn');
  const qrCodeContainer = document.getElementById('qrCode');
  const dlBtn = document.getElementById('downloadBtn');
  const prnBtn = document.getElementById('printBtn');

  let logoImage = null;

  textInput.addEventListener('input', () => { genBtn.disabled = !textInput.value.trim(); });

  logoFile.addEventListener('change', () => {
    const file = logoFile.files[0];
    if (!file) { logoImage=null; return; }
    if (!file.type.startsWith('image/')) { alert('Изображение!'); logoFile.value=''; logoImage=null; return; }
    const reader = new FileReader();
    reader.onload = () => { logoImage = new Image(); logoImage.src = reader.result; };
    reader.readAsDataURL(file);
  });

  async function generateQR() {
    const txt = textInput.value.trim(); if (!txt) return;
    qrCodeContainer.innerHTML = '';
    dlBtn.style.display = prnBtn.style.display = 'none';
    try {
      const size = +sizeSelect.value;
      const opts = { color:{dark:fgColor.value, light:bgColor.value}, margin:2, width:size };
      const canvas = document.createElement('canvas');
      await QRCode.toCanvas(canvas, txt, opts);
      if (logoImage) {
        const ctx = canvas.getContext('2d');
        const ls=size*0.2, x=(size-ls)/2, y=x;
        ctx.fillStyle=bgColor.value;
        ctx.beginPath(); ctx.arc(size/2,size/2,ls/1.8,0,2*Math.PI); ctx.fill();
        ctx.drawImage(logoImage,x,y,ls,ls);
      }
      qrCodeContainer.appendChild(canvas);
      dlBtn.style.display=prnBtn.style.display='inline-block';
    } catch(e){ qrCodeContainer.textContent='Ошибка'; console.error(e); dlBtn.style.display=prnBtn.style.display='none'; }
  }

  genBtn.addEventListener('click', generateQR);

  dlBtn.addEventListener('click', () => {
    const cv=qrCodeContainer.querySelector('canvas');
    if(!cv)return;
    cv.toBlob(blob=>{ const url=URL.createObjectURL(blob);
      const a=document.createElement('a');a.href=url;a.download='qr-code.png';
      document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
    },'image/png');
  });

  prnBtn.addEventListener('click', () => {
    const cv=qrCodeContainer.querySelector('canvas');
    if(!cv)return;
    const dataUrl=cv.toDataURL('image/png');
    const w=window.open('','_blank');
    w.document.write(`<html><head><title>Печать</title><style>body{margin:0;display:flex;justify-content:center;align-items:center;height:100vh;}img{max-width:90%;}</style></head><body><img src="${dataUrl}" onload="window.print();window.close();"/></body></html>`);
    w.document.close();
  });

  // --- Штрихкод EAN-13 панель ---
  const slide = document.getElementById('barcodeSlide');
  const openBtn = document.getElementById('openBarcodeBtn');
  const closeBtn = document.getElementById('closeBarcodeBtn');
  const eanInput = document.getElementById('eanInput');
  const genBarBtn = document.getElementById('genBarcodeBtn');
  const bcContainer = document.getElementById('barcodeContainer');
  const bcDl = document.getElementById('barcodeDownloadBtn');
  const bcPrn = document.getElementById('barcodePrintBtn');

  openBtn.addEventListener('click', () => { slide.classList.add('open'); });
  closeBtn.addEventListener('click', () => { slide.classList.remove('open'); });

  eanInput.addEventListener('input', () => {
    genBarBtn.disabled = !/^\d{12}$/.test(eanInput.value);
  });

  genBarBtn.addEventListener('click', () => {
    bcContainer.innerHTML = '';
    bcDl.style.display = bcPrn.style.display = 'none';
    try {
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      JsBarcode(svg, eanInput.value, { format:'ean13', displayValue:true, width:2, height:100 });
      bcContainer.appendChild(svg);
      bcDl.style.display = bcPrn.style.display = 'inline-block';
    } catch(e){ bcContainer.textContent='Ошибка'; console.error(e); }
  });

  bcDl.addEventListener('click', () => {
    const svg = bcContainer.querySelector('svg');
    if (!svg) return;
    const serializer = new XMLSerializer();
    const data = '<?xml version="1.0"?>' + serializer.serializeToString(svg);
    const svgBlob = new Blob([data], { type: 'image/svg+xml;charset=utf-8' });
    const url = URL.createObjectURL(svgBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'barcode.svg';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  bcPrn.addEventListener('click', () => {
    const svg = bcContainer.querySelector('svg');
    if (!svg) return;
    const data = new XMLSerializer().serializeToString(svg);
    const w = window.open('', '_blank');
    w.document.write(`<html><head><title>Печать</title><style>body{margin:0;display:flex;justify-content:center;align-items:center;height:100vh;}svg{max-width:90%;}</style></head><body>${data}<script>window.onload=()=>{window.print();window.close();};</script></body></html>`);
    w.document.close();
  });

})();
</script>
</body>
</html>